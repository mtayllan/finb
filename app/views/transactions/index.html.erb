<div class="w-full">
  <div class="flex flex-wrap justify-between items-center gap-2">
    <%= render UI::H1.new.with_content('Transactions') %>
    <div class="flex gap-2">
      <%= link_to chat_index_path, class: "btn btn-secondary" do %>
        <i class="ph ph-chat-circle-dots"></i>
        Quick Chat
      <% end %>
      <%= link_to "New Transaction", new_transaction_path, class: "btn btn-primary" %>
    </div>
  </div>

  <div class="my-4">
    <%= form_with url: transactions_path, method: :get, data: { turbo_action: "replace" } do |f| %>
      <%= hidden_field_tag :month, @month.strftime('%Y/%m') %>
      <%= hidden_field_tag :account_id, params[:account_id] if params[:account_id] %>
      <%= hidden_field_tag :category_id, params[:category_id] if params[:category_id] %>
      <div class="flex gap-2">
        <label class="input input-bordered flex items-center gap-2 flex-1">
          <i class="ph ph-magnifying-glass"></i>
          <%= f.search_field :search, value: params[:search], placeholder: "Search by description...", class: "grow", data: params[:search].present? ? { controller: "autofocus-end" } : {} %>
        </label>
        <%= f.submit "Search", class: "btn btn-primary" %>
        <% if params[:search].present? %>
          <%= link_to "Clear", url_for(params.permit(:month, :account_id, :category_id).except(:search)), class: "btn btn-ghost" %>
        <% end %>
      </div>
    <% end %>
  </div>

  <div class="flex justify-center items-center my-6 gap-8">
    <%=
      link_to @month.prev_month.strftime('%b %Y'),
              url_for(params.permit(:account_id, :category_id, :search).merge(month: @month.prev_month.strftime('%Y/%m'))),
              class: "link"
    %>

    <div class="text-2xl font-semibold tracking-tight"> <%= @month.strftime('%B %Y') %> </div>

    <%=
      link_to @month.next_month.strftime('%b %Y'),
              url_for(params.permit(:account_id, :category_id, :search).merge(month: @month.next_month.strftime('%Y/%m'))),
              class: "link"
    %>
  </div>

  <div class="overflow-x-auto">
    <table id="transactions" class="table table-zebra">
      <thead>
        <tr>
          <th>Date</th>
          <th>Description</th>
          <th>Category</th>
          <th>Account</th>
          <th>Value</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <%= render @transactions %>
      </tbody>
    </table>
  </div>
</div>
